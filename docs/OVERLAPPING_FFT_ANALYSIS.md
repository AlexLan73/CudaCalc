# üîç –ê–Ω–∞–ª–∏–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ FFT —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º –æ–∫–æ–Ω

## üìã –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –í–µ–∫—Ç–æ—Ä: 5 –ª—É—á–µ–π √ó 4096 —Ç–æ—á–µ–∫
- FFT16 —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º 75%
- –®–∞–≥ –æ–∫–Ω–∞: 2 –æ—Ç—á–µ—Ç–∞ (–≤–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞ –≤ —É—Å–ª–æ–≤–∏–∏)
- –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥: 4 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–∞ —Å —Å–¥–≤–∏–≥–æ–º —É–∫–∞–∑–∞—Ç–µ–ª—è

## üéØ –ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å

**–õ—É—á—à–µ –ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ–¥–∏–Ω –¥–ª–∏–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –∏–∑ 4 –±–ª–æ–∫–æ–≤ –∏ –≤–∑—è—Ç—å —Å—Ä–∞–∑—É FFT16, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–∞ 4 —Ä–∞–∑–∞ –≤ –ø–∞–º—è—Ç–∏?**

## üìä –ê–Ω–∞–ª–∏–∑ –ø–æ–¥—Ö–æ–¥–æ–≤

### –ü–æ–¥—Ö–æ–¥ 1: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã (—Ç–µ–∫—É—â–∏–π)

```cpp
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
for (int i = 0; i < 4; ++i) {
    cuComplex* window_ptr = input_data + i * 2;  // –°–¥–≤–∏–≥ –Ω–∞ 2 –æ—Ç—á–µ—Ç–∞
    launch_fft16_simple(window_ptr, output + i * 16, 1);  // 1 –æ–∫–Ω–æ
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **4 kernel launch'–∞**
- **4 H2D –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è** (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤ GPU)
- **Latency**: 4 √ó kernel_latency
- **Memory access**: 4 √ó 16 —Ç–æ—á–µ–∫ = 64 —Ç–æ—á–∫–∏

### –ü–æ–¥—Ö–æ–¥ 2: –û–¥–∏–Ω –±–æ–ª—å—à–æ–π –≤–µ–∫—Ç–æ—Ä (–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π)

```cpp
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–∫–Ω–∞ –≤ –æ–¥–∏–Ω –º–∞—Å—Å–∏–≤
cuComplex big_vector[64];  // 4 –æ–∫–Ω–∞ √ó 16 —Ç–æ—á–µ–∫
for (int i = 0; i < 4; ++i) {
    memcpy(big_vector + i * 16, input_data + i * 2, 16 * sizeof(cuComplex));
}
// –û–¥–∏–Ω –≤—ã–∑–æ–≤ FFT16 –¥–ª—è 4 –æ–∫–æ–Ω
launch_fft16_simple(big_vector, output, 4);
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **1 kernel launch**
- **1 H2D –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤ GPU)
- **Latency**: 1 √ó kernel_latency
- **Memory access**: 1 √ó 64 —Ç–æ—á–∫–∏ = 64 —Ç–æ—á–∫–∏

## üî¨ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. Kernel Launch Overhead

**–ò–∑ –Ω–∞—à–µ–≥–æ benchmark'–∞ FFT16:**
- **1 –æ–∫–Ω–æ**: 0.003072 ms
- **4 –æ–∫–Ω–∞**: ~0.003072 ms (–ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

**–í—ã–≤–æ–¥**: Kernel launch overhead –º–∏–Ω–∏–º–∞–ª–µ–Ω –¥–ª—è –º–∞–ª—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤.

### 2. Memory Copy Overhead

**–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π):**
- **–ü–æ–¥—Ö–æ–¥ 1**: 0 –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–π (—É–∫–∞–∑–∞—Ç–µ–ª–∏)
- **–ü–æ–¥—Ö–æ–¥ 2**: 1 –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ 64 —Ç–æ—á–µ–∫ = ~0.001 ms

**–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ CPU:**
- **–ü–æ–¥—Ö–æ–¥ 1**: 4 √ó H2D –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü–æ–¥—Ö–æ–¥ 2**: 1 √ó H2D –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ + 1 –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. Memory Access Patterns

**–ü–æ–¥—Ö–æ–¥ 1 (—Å–¥–≤–∏–≥ —É–∫–∞–∑–∞—Ç–µ–ª—è):**
```
–û–∫–Ω–æ 1: [0, 15]     - 16 —Ç–æ—á–µ–∫
–û–∫–Ω–æ 2: [2, 17]     - 16 —Ç–æ—á–µ–∫ (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 87.5%)
–û–∫–Ω–æ 3: [4, 19]     - 16 —Ç–æ—á–µ–∫ (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 87.5%)
–û–∫–Ω–æ 4: [6, 21]     - 16 —Ç–æ—á–µ–∫ (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 87.5%)
```

**–ü–æ–¥—Ö–æ–¥ 2 (–æ–¥–∏–Ω –≤–µ–∫—Ç–æ—Ä):**
```
[0,15][2,17][4,19][6,21] - 64 —Ç–æ—á–∫–∏ –ø–æ–¥—Ä—è–¥
```

### 4. GPU Memory Bandwidth

**–ù–∞—à–∏ FFT16 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
- **–ü–∏–∫–æ–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2.23 TFLOP/s –ø—Ä–∏ 262k+ –æ–∫–æ–Ω
- **–ü—Ä–∏ 4 –æ–∫–Ω–∞—Ö**: ~33 GFLOP/s (–Ω–∏–∑–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)

## üéØ –û–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –≤ —É—Å–ª–æ–≤–∏–∏ –∑–∞–¥–∞—á–∏

**–í—ã —É–∫–∞–∑–∞–ª–∏ —à–∞–≥ 2 –æ—Ç—á–µ—Ç–∞, –Ω–æ —ç—Ç–æ –ù–ï 75% –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ!**

- **FFT16 = 16 —Ç–æ—á–µ–∫**
- **75% –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ = 25% –Ω–æ–≤–æ–µ** ‚Üí —à–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 4 —Ç–æ—á–∫–∏ (16 √ó 0.25 = 4)
- **–ü—Ä–∏ —à–∞–≥–µ 2**: –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ = 87.5% (14/16)

### ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–î–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏ (5 –ª—É—á–µ–π √ó 4096 —Ç–æ—á–µ–∫) —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:**

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —à–∞–≥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ 2)
```cpp
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –ª—É—á–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
const int num_windows_per_ray = (4096 - 16) / 2 + 1;  // ~2040 –æ–∫–æ–Ω –Ω–∞ –ª—É—á
const int total_windows = 5 * num_windows_per_ray;     // ~10200 –æ–∫–æ–Ω

// –û–¥–∏–Ω –±–æ–ª—å—à–æ–π –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –æ–∫–æ–Ω
std::vector<cuComplex> all_windows(total_windows * 16);

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–∫–æ–Ω (–º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å)
for (int ray = 0; ray < 5; ++ray) {
    for (int win = 0; win < num_windows_per_ray; ++win) {
        int src_start = win * 2;
        int dst_start = (ray * num_windows_per_ray + win) * 16;
        memcpy(&all_windows[dst_start], &input_data[ray * 4096 + src_start], 16 * sizeof(cuComplex));
    }
}

// –û–¥–∏–Ω –≤—ã–∑–æ–≤ FFT16 –¥–ª—è –≤—Å–µ—Ö –æ–∫–æ–Ω
launch_fft16_simple(all_windows.data(), output, total_windows);
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ï—Å–ª–∏ —à–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 4 (75% –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ)
```cpp
const int num_windows_per_ray = (4096 - 16) / 4 + 1;  // ~1023 –æ–∫–Ω–∞ –Ω–∞ –ª—É—á
const int total_windows = 5 * num_windows_per_ray;     // ~5115 –æ–∫–æ–Ω

// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ —Å —à–∞–≥–æ–º 4
```

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **Kernel launches**: 5 √ó 2040 = 10200 ‚Üí 1 –≤—ã–∑–æ–≤
- **Reduction –≤ latency**: ~10200x
- **Memory bandwidth**: –ª—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–æ–¥–Ω–∞ –±–æ–ª—å—à–∞—è –ø–µ—Ä–µ–¥–∞—á–∞)

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ü–∏—Ñ—Ä—ã:
- **–¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥**: 10200 √ó 0.003072 ms = ~31.4 ms
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**: ~0.003072 ms (–æ–¥–∏–Ω –≤—ã–∑–æ–≤)
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: ~10200x –≤ latency!

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. Memory Management
```cpp
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pinned memory –¥–ª—è H2D –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–π
cudaMallocHost(&pinned_input, total_size);
cudaMalloc(&gpu_input, total_size);
cudaMalloc(&gpu_output, total_windows * 16 * sizeof(cuComplex));
```

### 2. Streams –¥–ª—è –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è
```cpp
// –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ
cudaStream_t streams[2];
for (int i = 0; i < 2; ++i) cudaStreamCreate(&streams[i]);

// –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ: H2D(next) || kernel(curr) || D2H(prev)
```

### 3. Batch size optimization
- **–ò–∑ –Ω–∞—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞**: –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π batch = 8k-64k –æ–∫–æ–Ω
- **–í–∞—à–∏ ~10k –æ–∫–æ–Ω**: –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∑–æ–Ω—É!

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ê, –≤–∞—à –ø–æ–¥—Ö–æ–¥ —Å –æ–¥–Ω–∏–º –±–æ–ª—å—à–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º –ü–†–ê–í–ò–õ–¨–ù–´–ô!**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. **Latency reduction**: 10200x —É–ª—É—á—à–µ–Ω–∏–µ
2. **Memory efficiency**: –ª—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bandwidth
3. **GPU utilization**: –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∑–æ–Ω—É batch size
4. **Code simplicity**: –æ–¥–∏–Ω kernel launch –≤–º–µ—Å—Ç–æ 10200

**–ù–û**: —É—Ç–æ—á–Ω–∏—Ç–µ —à–∞–≥ –æ–∫–Ω–∞ - 2 –∏–ª–∏ 4 –æ—Ç—á–µ—Ç–∞?

---

*–ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –Ω–∞—à–µ–≥–æ comprehensive FFT benchmark –∏ occupancy sweep*


